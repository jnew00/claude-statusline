# Docker Compose for Claude Plan Usage Scraper
# For Unraid, you can also configure this via the Docker UI

version: '3.8'

services:
  # Main daemon service - runs scraper periodically and serves JSON
  claude-scraper:
    image: claude-plan-usage
    container_name: claude-plan-usage
    restart: unless-stopped
    command: daemon

    ports:
      # HTTP server for JSON access
      - "8577:8080"
      # VNC for re-login when session expires
      - "5901:5900"

    volumes:
      - claude-data:/data

    environment:
      - SCRAPE_INTERVAL=600
      - HTTP_PORT=8080
      - VNC_PORT=5900
      # Enable VNC in daemon mode for re-login capability
      - ENABLE_VNC=true

    deploy:
      resources:
        limits:
          memory: 1G
        reservations:
          memory: 512M

  # Login service - use this for initial login or re-login
  # Run with: docker-compose run --service-ports login
  login:
    image: claude-plan-usage
    container_name: claude-plan-usage-login
    command: login
    profiles:
      - login

    ports:
      - "5901:5900"

    volumes:
      - claude-data:/data

    environment:
      - VNC_PORT=5900

    stdin_open: true
    tty: true

volumes:
  claude-data:
    name: claude-plan-usage-data
