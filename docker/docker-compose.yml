# Docker Compose for Claude Plan Usage Scraper
# For Unraid, you can also configure this via the Docker UI

version: '3.8'

services:
  claude-scraper:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    container_name: claude-plan-usage
    restart: unless-stopped

    # Run in daemon mode (scrape every 10 minutes + serve HTTP)
    command: daemon

    ports:
      # HTTP server for JSON access
      - "8080:8080"
      # VNC for login (can be removed after initial login)
      - "5900:5900"

    volumes:
      # Persistent storage for browser profile and output
      - claude-data:/data

    environment:
      # Scrape interval in seconds (default: 600 = 10 minutes)
      - SCRAPE_INTERVAL=600
      # HTTP port (inside container)
      - HTTP_PORT=8080
      # VNC port (inside container)
      - VNC_PORT=5900

    # Resource limits (adjust as needed)
    deploy:
      resources:
        limits:
          memory: 1G
        reservations:
          memory: 512M

volumes:
  claude-data:
    name: claude-plan-usage-data
